generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url = env("DATABASE_URL")
}

model User {
  id               Int            @id @default(autoincrement())
  name             String         @db.VarChar(100)
  email            String         @unique(map: "email") @db.VarChar(100)
  password         String         @db.VarChar(255)
  phone            String?        @db.VarChar(20)
  role             Role?          @default(user)
  resetToken       String?        @map("reset_token") @db.VarChar(255)
  resetTokenExpire DateTime?      @map("reset_token_expire") @db.DateTime(0)
  createdAt        DateTime?      @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt        DateTime?      @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)
  bookings         Booking[]
  payments         Payment[]
  professionals    Professional[]
  rentals          Rental[]
  sessions         Session[]

  @@index([email], map: "idx_email")
  @@index([resetToken], map: "idx_reset_token")
  @@map("users")
}

model Session {
  id           Int       @id @default(autoincrement())
  userId       Int       @map("user_id")
  sessionToken String    @unique(map: "session_token") @map("session_token") @db.VarChar(255)
  expiresAt    DateTime  @map("expires_at") @db.DateTime(0)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sessions_ibfk_1")

  @@index([expiresAt], map: "idx_expires_at")
  @@index([sessionToken], map: "idx_session_token")
  @@index([userId], map: "idx_user_id")
  @@map("sessions")
}

model Hardware {
  hardwareId        Int       @id @default(autoincrement()) @map("hardware_id")
  name              String    @db.VarChar(100)
  category          String?   @db.VarChar(50)
  description       String?   @db.Text
  price             Decimal   @db.Decimal(10, 2)
  rentalPricePerDay Decimal?  @map("rental_price_per_day") @db.Decimal(10, 2)
  stockQuantity     Int?      @default(0) @map("stock_quantity")
  imageUrl          String?   @map("image_url") @db.VarChar(255)
  isAvailable       Boolean?  @default(true) @map("is_available")
  createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt         DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)
  rentals           Rental[]

  @@index([isAvailable], map: "idx_available")
  @@index([category], map: "idx_category")
  @@map("hardware")
}

model Professional {
  professionalId  Int       @id @default(autoincrement()) @map("professional_id")
  userId          Int?      @map("user_id")
  skill           String    @db.VarChar(100)
  experienceYears Int?      @map("experience_years")
  hourlyRate      Decimal?  @map("hourly_rate") @db.Decimal(10, 2)
  bio             String?   @db.Text
  rating          Decimal?  @default(0.00) @db.Decimal(3, 2)
  isAvailable     Boolean?  @default(true) @map("is_available")
  createdAt       DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  bookings        Booking[]
  user            User?     @relation(fields: [userId], references: [id], onUpdate: NoAction, map: "professional_ibfk_1")

  @@index([isAvailable], map: "idx_available")
  @@index([skill], map: "idx_skill")
  @@index([userId], map: "user_id")
  @@map("professional")
}

model Payment {
  paymentId     Int       @id @default(autoincrement()) @map("payment_id")
  userId        Int       @map("user_id")
  amount        Decimal   @db.Decimal(10, 2)
  method        String?   @default("cash") @db.VarChar(50)
  status        String?   @default("pending") @db.VarChar(30)
  paymentDate   DateTime? @default(now()) @map("payment_date") @db.Timestamp(0)
  transactionId String?   @map("transaction_id") @db.VarChar(100)
  bookings      Booking[]
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payment_ibfk_1")
  rentals       Rental[]

  @@index([paymentDate], map: "idx_payment_date")
  @@index([status], map: "idx_status")
  @@index([userId], map: "idx_user_id")
  @@map("payment")
}

model Rental {
  rentalId    Int       @id @default(autoincrement()) @map("rental_id")
  userId      Int       @map("user_id")
  hardwareId  Int       @map("hardware_id")
  startDate   DateTime  @map("start_date") @db.Date
  endDate     DateTime  @map("end_date") @db.Date
  returnDate  DateTime? @map("return_date") @db.Date
  totalAmount Decimal?  @map("total_amount") @db.Decimal(10, 2)
  status      String?   @default("active") @db.VarChar(30)
  paymentId   Int?      @map("payment_id")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "rental_ibfk_1")
  hardware    Hardware  @relation(fields: [hardwareId], references: [hardwareId], onDelete: Cascade, onUpdate: NoAction, map: "rental_ibfk_2")
  payment     Payment?  @relation(fields: [paymentId], references: [paymentId], onUpdate: NoAction, map: "rental_ibfk_3")

  @@index([startDate, endDate], map: "idx_dates")
  @@index([hardwareId], map: "idx_hardware_id")
  @@index([status], map: "idx_status")
  @@index([userId], map: "idx_user_id")
  @@index([paymentId], map: "payment_id")
  @@map("rental")
}

model Booking {
  bookingId      Int          @id @default(autoincrement()) @map("booking_id")
  userId         Int          @map("user_id")
  professionalId Int          @map("professional_id")
  bookingDate    DateTime     @map("booking_date") @db.Date
  serviceHours   Int?         @map("service_hours")
  totalAmount    Decimal?     @map("total_amount") @db.Decimal(10, 2)
  status         String?      @default("pending") @db.VarChar(30)
  paymentId      Int?         @map("payment_id")
  notes          String?      @db.Text
  createdAt      DateTime?    @default(now()) @map("created_at") @db.Timestamp(0)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "booking_ibfk_1")
  professional   Professional @relation(fields: [professionalId], references: [professionalId], onDelete: Cascade, onUpdate: NoAction, map: "booking_ibfk_2")
  payment        Payment?     @relation(fields: [paymentId], references: [paymentId], onUpdate: NoAction, map: "booking_ibfk_3")

  @@index([bookingDate], map: "idx_booking_date")
  @@index([professionalId], map: "idx_professional_id")
  @@index([status], map: "idx_status")
  @@index([userId], map: "idx_user_id")
  @@index([paymentId], map: "payment_id")
  @@map("booking")
}

enum Role {
  user
  admin
}
