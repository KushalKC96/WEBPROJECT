generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ============================================
// USERS & AUTHENTICATION
// ============================================

model User {
  id                 Int            @id @default(autoincrement())
  name               String         @db.VarChar(100)
  email              String         @unique @db.VarChar(100)
  password           String         @db.VarChar(255)
  phone              String?        @db.VarChar(20)
  role               Role           @default(user)
  resetToken         String?        @map("reset_token") @db.VarChar(255)
  resetTokenExpire   DateTime?      @map("reset_token_expire")
  createdAt          DateTime       @default(now()) @map("created_at")
  updatedAt          DateTime       @updatedAt @map("updated_at")

  // Relations
  sessions           Session[]
  rentals            Rental[]
  bookings           Booking[]
  payments           Payment[]
  professionals      Professional[]

  @@index([email])
  @@index([resetToken])
  @@map("users")
}

enum Role {
  user
  admin
}

model Session {
  id            Int       @id @default(autoincrement())
  userId        Int       @map("user_id")
  sessionToken  String    @unique @map("session_token") @db.VarChar(255)
  expiresAt     DateTime  @map("expires_at")
  createdAt     DateTime  @default(now()) @map("created_at")

  // Relations
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionToken])
  @@index([userId])
  @@index([expiresAt])
  @@map("sessions")
}

// ============================================
// HARDWARE & PRODUCTS
// ============================================

model Hardware {
  hardwareId        Int       @id @default(autoincrement()) @map("hardware_id")
  name              String    @db.VarChar(100)
  category          String?   @db.VarChar(50)
  description       String?   @db.Text
  price             Decimal   @db.Decimal(10, 2)
  rentalPricePerDay Decimal?  @map("rental_price_per_day") @db.Decimal(10, 2)
  stockQuantity     Int       @default(0) @map("stock_quantity")
  imageUrl          String?   @map("image_url") @db.VarChar(255)
  isAvailable       Boolean   @default(true) @map("is_available")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relations
  rentals           Rental[]

  @@index([category])
  @@index([isAvailable])
  @@map("hardware")
}

// ============================================
// PROFESSIONALS
// ============================================

model Professional {
  professionalId   Int       @id @default(autoincrement()) @map("professional_id")
  userId           Int?      @map("user_id")
  skill            String    @db.VarChar(100)
  experienceYears  Int?      @map("experience_years")
  hourlyRate       Decimal?  @map("hourly_rate") @db.Decimal(10, 2)
  bio              String?   @db.Text
  rating           Decimal   @default(0.00) @db.Decimal(3, 2)
  isAvailable      Boolean   @default(true) @map("is_available")
  createdAt        DateTime  @default(now()) @map("created_at")

  // Relations
  user             User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  bookings         Booking[]

  @@index([skill])
  @@index([isAvailable])
  @@map("professional")
}

// ============================================
// PAYMENTS
// ============================================

model Payment {
  paymentId      Int       @id @default(autoincrement()) @map("payment_id")
  userId         Int       @map("user_id")
  amount         Decimal   @db.Decimal(10, 2)
  method         String?   @default("cash") @db.VarChar(50)
  status         String?   @default("pending") @db.VarChar(30)
  paymentDate    DateTime  @default(now()) @map("payment_date")
  transactionId  String?   @map("transaction_id") @db.VarChar(100)

  // Relations
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  rentals        Rental[]
  bookings       Booking[]

  @@index([userId])
  @@index([status])
  @@index([paymentDate])
  @@map("payment")
}

// ============================================
// RENTALS
// ============================================

model Rental {
  rentalId      Int       @id @default(autoincrement()) @map("rental_id")
  userId        Int       @map("user_id")
  hardwareId    Int       @map("hardware_id")
  startDate     DateTime  @map("start_date") @db.Date
  endDate       DateTime  @map("end_date") @db.Date
  returnDate    DateTime? @map("return_date") @db.Date
  totalAmount   Decimal?  @map("total_amount") @db.Decimal(10, 2)
  status        String    @default("active") @db.VarChar(30)
  paymentId     Int?      @map("payment_id")
  createdAt     DateTime  @default(now()) @map("created_at")

  // Relations
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  hardware      Hardware  @relation(fields: [hardwareId], references: [hardwareId], onDelete: Cascade)
  payment       Payment?  @relation(fields: [paymentId], references: [paymentId], onDelete: SetNull)

  @@index([userId])
  @@index([hardwareId])
  @@index([status])
  @@index([startDate, endDate])
  @@map("rental")
}

// ============================================
// BOOKINGS
// ============================================

model Booking {
  bookingId      Int       @id @default(autoincrement()) @map("booking_id")
  userId         Int       @map("user_id")
  professionalId Int       @map("professional_id")
  bookingDate    DateTime  @map("booking_date") @db.Date
  serviceHours   Int?      @map("service_hours")
  totalAmount    Decimal?  @map("total_amount") @db.Decimal(10, 2)
  status         String    @default("pending") @db.VarChar(30)
  paymentId      Int?      @map("payment_id")
  notes          String?   @db.Text
  createdAt      DateTime  @default(now()) @map("created_at")

  // Relations
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  professional   Professional  @relation(fields: [professionalId], references: [professionalId], onDelete: Cascade)
  payment        Payment?      @relation(fields: [paymentId], references: [paymentId], onDelete: SetNull)

  @@index([userId])
  @@index([professionalId])
  @@index([status])
  @@index([bookingDate])
  @@map("booking")
}